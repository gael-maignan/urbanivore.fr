<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Identification de plante</title>
</head>
<body>
  <h2>Résultat de l’identification :</h2>
  <div id="resultat">Analyse en cours...</div>

  <script type="module">
    async function urlToFile(url, filename) {
      const res = await fetch(url);
      const blob = await res.blob();
      return new File([blob], filename, { type: blob.type });
    }

    async function identify() {
      const image2 = await urlToFile('https://urbanivore.fr/collaborate/image_2.jpeg', 'img2.jpeg');

      const form = new FormData();
      form.append('organs', 'leaf');
      form.append('images', image2);

      try {
        const response = await fetch(
          `https://my-api.plantnet.org/v2/identify/all?api-key=2b10Is89LUbOJaKfi7OCou6jsO`,
          {
            method: 'POST',
            body: form,
          }
        );

        const result = await response.json();
        console.log(result);

        // On récupère le conteneur du résultat
        const div = document.getElementById('resultat');

        if (result.bestMatch) {
          div.innerHTML = `
            <p><strong>Nom scientifique :</strong> ${result.bestMatch.scientificNameWithoutAuthor}</p>
            <p><strong>Nom commun :</strong> ${result.bestMatch.commonNames?.join(', ') || 'Non disponible'}</p>
            <p><strong>Score :</strong> ${(result.bestMatch.score * 100).toFixed(2)}%</p>
          `;
        } else {
          div.innerHTML = '<p>Aucun résultat trouvé.</p>';
        }

      } catch (error) {
        console.error(error);
        document.getElementById('resultat').innerHTML = '<p>Erreur lors de l’identification.</p>';
      }
    }

    identify();
  </script>
</body>
</html>


<!--
<script type="module">
async function urlToFile(url, filename) {
  const res = await fetch(url);
  const blob = await res.blob();
  return new File([blob], filename, { type: blob.type });
}

async function identify() {
  //const image1 = await urlToFile('https://urbanivore.fr/collaborate/image_1.jpeg', 'img1.jpeg');
  const image2 = await urlToFile('https://urbanivore.fr/collaborate/image_2.jpeg', 'img2.jpeg');

  const form = new FormData();
  //form.append('organs', 'flower');
  //form.append('images', image1);
  form.append('organs', 'leaf');
  form.append('images', image2);

  const response = await fetch(
    `https://my-api.plantnet.org/v2/identify/all?api-key=2b10Is89LUbOJaKfi7OCou6jsO`,
    {
      method: 'POST',
      body: form,
    }
  );

  let result = await response.json();
  console.log(result.bestMatch);

}
identify();

</script>
-->